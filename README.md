###### Ru_Const

- Корпус с разметкой по связям, составляющим, морфологии и т.п. (получен на данных Lenta.ru)
- Поиск по корпусу осуществляется при помощи прилагаемого скрипта, см. ниже
- Первая версия поискового скрипта была написана при участии [Ильи Козиева](https://github.com/Koziev)

### Копирование поискового скрипта и датасета с корпусом

1. Скачиваем архив или клонируем данный репозиторий - он содержит поисковые скрипты и примеры правил

2. Загружаем и распаковываем архив с данными корпуса [отсюда](https://disk.yandex.ru/d/TamirmJ-ZP1fVg)

### Настройка скрипта для извлечения примеров (Ex_Extractor):

### Запуск

Из корневой папки с файлом EX_tractor_N.N.py
```
python3 EX_tractor_1.3.py
```
Параметры задают место расположения правил (--rules по умолчанию: Rules/23), директорию с текущими примера в формате json (--dir_in, по умолчанию: Input/main), файл с текстовым результатом (--output_txt, по умолчанию: Output/search_result.txt), файл с результатом в csv (--output_csv, по умолчанию: Output/search_result.csv), выдачу текстового (--verbosity) и csv (--csv_verbosity) файлов (по умолчанию оба 1)
```
usage: EX_tractor_1.3.py [-h] [--rules RULES] [--dir_in DIR_IN] [--output_txt OUTPUT_TXT]
                           [--verbosity VERBOSITY] [--output_csv OUTPUT_CSV]
                           [--csv_verbosity CSV_VERBOSITY]
```

Поисковый скрипт считывает все правила в формате yaml из указанной папки. Если файл имеет расширение не yaml, правила считаны не будут.

## Пример запуска
```
...#Sandbox% python3 EX_tractor_1.3.py --dir_in Input_ --csv_verbosity 0  --rules

```
Запуск с поиском по папке Input_ (куда можно положить подкорпус для какого-либо эксперимента) и без выдачи csv


#### Для извлечения примеров используются:

1. Предложение, его ID
1. Все составляющие с такой информацией:  
   1.1. Тип (NP, VP, ...)  
   1.2. Вершина  
   1.3. Морфологические характеристики
2. Все словоформы с такой информацией:  
   2.1. В какую непосредственную составляющую входит (AP, NP, VP, ...): тип фразы, текст  
   2.2. Является ли вершиной  
   2.3. Морфологические характеристики  
   2.4. Тип входящей зависимости


### Инпут:

Корпус состоит из двух больших частей: 1 и 2 (2_1, 2_2, 2_3) и хранится в json-файлах.
Каждый является список из питоновских словарей, содержащих предложение с разметкой. В словаре указывается ID, длина, скобочное представление и ссылка на предложение в интернете (на сайте Ленты). Кроме этого словарь содержит детальную информацию о токенах и составляющих.
Примеры отдельных словарей можно посмотреть в папке Input_Examples или получить словарь с конкретным примером с помощью скрипта show_json.py, см. ниже. Изучение того, как хранятся отдельные примеры может помочь понять, как задавать поиск по разным критериям (Morph, Links, Lex, LexNonHead). В целом знать структуру корпуса не обязательно.


### Выдача, просмотр результата:

После получения и отсмотра результата в текстовом или csv формате может возникнуть необходимость в коррекции правил поиска. В этом случае рекомендуется вывести в папку с результатами конкретный интересующий пример в формате json-файла. Для этого нужно задать команду

```
python3 show_json.py --exnum 1_4
```
где --exnum - параметр для задания ID примера, а "1_4" - само ID (ID после параметра exnum всегда пишем без "#")
ID всегда имеет в составе разделитель "_" между двумя цифрами, его можно посмотреть в текстовом или csv файлах:

```
=>из предложения #153316_5
```

```
ex_id	id...
1	84457_13
```

Кроме exnum how_json.py имеет параметры dir_in (по умолчанию Input/main), outdir (по умолчанию Output)

Если файл csv хотим открывать в Excel, при импорте внешних данных нужно выбрать кодировку UTF-8

### Примеры правил:


## Формат правил  

Правила задаются в .yaml - файлах.

### Файл с правилами имеет структуру:  

```
ExampleName: Coord_SG_post
Priority: 1
SubExamples
Name: Rule1
Participants:
  - Obligatory: <List>
  - Optional: <List>
..  
Name: Rule2  
```

Правила для одних и тех же типов примеров располагаются внутри одной и той же секции.  
Структура примера, т.е. наличие у него определенных участников, их название и обязательность/факультативность -- задаются на уровне SubExamples.  

Отдельные ExampleName лучше заводить в отдельных файлах. При этом файлов для поиска может быть более одного.

### Синтаксис правил:  

```
ExampleName: MyExample
SubExamples: MySubExample
ID
Participants:  
  - Obligatory: Ob1, Ob2, ...  
  - Optional: Op1, Op2, ...  
Items:
  - A: ItemName/Dummy
    (Restriction1)
    (Restriction2) ...  
  - B: ItemName/Dummy
    (Restriction1)
    (Restriction2) ...  
...  
Links:
  - B,A: <link>
  - B,C: <link>
  ...  
Constraints:
    - Order: B, A
...
```


'#' -- комментарии  
ID -- ID правила

**Items**: составляющая/вершина или другой элемент. Item может быть необходимой для вывода и анализа единицей, но может использоваться и просто для ограничений синтаксической конструкции, в последнем случае (когда не надо выводить в аутпут) напротив ярлыка данного Item (A, B,...) ставим Dummy
Другие типы элементов:
Obligatory -- обязательный элемент, без него пример не будет выделяться  
Optional -- в этом случае пример будет выделяться в отсутствие данного элемента   
Key -- сам пример (этим типом можно не пользоваться)

В каждом правиле должен быть как минимум один обязательный элемент.  

**Links**: типы связи в формате дерева зависимостей согласно нотации UD, см. https://universaldependencies.org/u/dep/all.html.
Кроме перечисленных там допустима также произвольная связь any (иногда работает некорректно на данном этапе).  

Пример: связь из вершины B в субъектную именную группу A   
```
Links:
  - B,A: nsubj
```

NB! В данном корпусе направление связи -- от предлога к существительному (а не наоборот, как в UD)

#### Синтаксис ограничений на элементы примеров (Restriction)

**ConstituentType**: тип составляющей (NP, VP, ...)

Освновные типы составляющих:
'NP' (именная группа), 'VP' (глагольная группа и предложение), 'AP' (группа прилагательного), 'PP' (предложная группа), 'AdvP' (группа наречия), 'NumP' (группа числительного), 'PartP' (группа причастия)
Вспомогательные составляющие, возглавляемые союзами, междометиями, частицами и т.п.
'CCONJP', 'INTJP', 'Particle', 'SCONJP', 'SYMP', 'XP'

**Morph**: Граммемы в нотации UD, https://universaldependencies.org/cop/morphology.html, https://universaldependencies.org/u/feat/all.html.  
Все значения пишутся после названия категории и знака "=", без пробелов (например, Variant=Short - для краткой формы прилагательного). Частеречные теги пишутся капслоком отдельно ('VERB'; NB: бытийная связка - AUX).
Кроме этого добавлена информация о переходности, она также задается при поиске отдельно ('tran', 'intran')

**Lex**: нормальная форма, являющаяся вершиной (таких большинство, is_head	true).  

**LexNonHead**: нормальная форма словоформы, не являющейся вершиной (is_head	false). Метка такого лексического ограничения используется всегда, когда словоформа не является ничьей вершиной

**List**: список нормальных форм, выделенный в отдельный файл (лексикон), имя в квадратных скобках совпадает с именем файла типа *.txt - без расширения (NB)

**|** -- логическое "или"
**NOT=>** -- логическое "нет", пока реализовано только для морфологии

Примеры:

```
ConstituentType: NP | AP | VP | AdvP | PP
```

```
Lex: мочь|смочь
```

```
Morph: NOT => Case=Nom
```
